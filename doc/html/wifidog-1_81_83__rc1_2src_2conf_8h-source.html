<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>WifiDog: conf.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>conf.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/********************************************************************\</span>
<a name="l00002"></a>00002 <span class="comment"> * This program is free software; you can redistribute it and/or    *</span>
<a name="l00003"></a>00003 <span class="comment"> * modify it under the terms of the GNU General Public License as   *</span>
<a name="l00004"></a>00004 <span class="comment"> * published by the Free Software Foundation; either version 2 of   *</span>
<a name="l00005"></a>00005 <span class="comment"> * the License, or (at your option) any later version.              *</span>
<a name="l00006"></a>00006 <span class="comment"> *                                                                  *</span>
<a name="l00007"></a>00007 <span class="comment"> * This program is distributed in the hope that it will be useful,  *</span>
<a name="l00008"></a>00008 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of   *</span>
<a name="l00009"></a>00009 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the    *</span>
<a name="l00010"></a>00010 <span class="comment"> * GNU General Public License for more details.                     *</span>
<a name="l00011"></a>00011 <span class="comment"> *                                                                  *</span>
<a name="l00012"></a>00012 <span class="comment"> * You should have received a copy of the GNU General Public License*</span>
<a name="l00013"></a>00013 <span class="comment"> * along with this program; if not, contact:                        *</span>
<a name="l00014"></a>00014 <span class="comment"> *                                                                  *</span>
<a name="l00015"></a>00015 <span class="comment"> * Free Software Foundation           Voice:  +1-617-542-5942       *</span>
<a name="l00016"></a>00016 <span class="comment"> * 59 Temple Place - Suite 330        Fax:    +1-617-542-2652       *</span>
<a name="l00017"></a>00017 <span class="comment"> * Boston, MA  02111-1307,  USA       gnu@gnu.org                   *</span>
<a name="l00018"></a>00018 <span class="comment"> *                                                                  *</span>
<a name="l00019"></a>00019 <span class="comment">\********************************************************************/</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">/* $Id: conf.h 1241 2007-06-24 04:13:13Z benoitg $ */</span>
<a name="l00027"></a>00027 <span class="preprocessor">#ifndef _CONFIG_H_</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define _CONFIG_H_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="preprocessor">#define NUM_EXT_INTERFACE_DETECT_RETRY 120</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="preprocessor">#define EXT_INTERFACE_DETECT_RETRY_INTERVAL 1</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifndef SYSCONFDIR</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">        #define DEFAULT_CONFIGFILE "/etc/wifidog.conf"</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">        #define DEFAULT_CONFIGFILE SYSCONFDIR"/wifidog.conf"</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#endif  </span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_DAEMON 1</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_DEBUGLEVEL LOG_INFO</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_HTTPDMAXCONN 10</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_GATEWAYID NULL</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_GATEWAYPORT 2060</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_HTTPDNAME "WiFiDog"</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_CLIENTTIMEOUT 5</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_CHECKINTERVAL 60</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_LOG_SYSLOG 0</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_SYSLOG_FACILITY LOG_DAEMON</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_WDCTL_SOCK "/tmp/wdctl.sock"</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_INTERNAL_SOCK "/tmp/wifidog.sock"</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_AUTHSERVPORT 80</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_AUTHSERVSSLPORT 443</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="preprocessor">#define DEFAULT_AUTHSERVSSLAVAILABLE 0</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="preprocessor">#define DEFAULT_AUTHSERVPATH "/wifidog/"</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00068"></a>00068 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__auth__serv__t.html">_auth_serv_t</a> {
<a name="l00069"></a><a class="code" href="struct__auth__serv__t.html#175f8cddd51f79e81679c70e2ce172f3">00069</a>     <span class="keywordtype">char</span> *<a class="code" href="struct__auth__serv__t.html#175f8cddd51f79e81679c70e2ce172f3">authserv_hostname</a>;    
<a name="l00070"></a><a class="code" href="struct__auth__serv__t.html#ff64f568944bbf0b01bb379b17ae2161">00070</a>     <span class="keywordtype">char</span> *<a class="code" href="struct__auth__serv__t.html#ff64f568944bbf0b01bb379b17ae2161">authserv_path</a>;        
<a name="l00071"></a>00071     <span class="keywordtype">int</span> <a class="code" href="struct__auth__serv__t.html#7f1ad17f9e62f68144ff1981def918fb">authserv_http_port</a>;     
<a name="l00073"></a>00073     <span class="keywordtype">int</span> <a class="code" href="struct__auth__serv__t.html#f4d82be7a680c24437a91ed1467f8921">authserv_ssl_port</a>;      
<a name="l00075"></a>00075     <span class="keywordtype">int</span> <a class="code" href="struct__auth__serv__t.html#87bde1ef8a18890d18858a360d276098">authserv_use_ssl</a>;       
<a name="l00076"></a><a class="code" href="struct__auth__serv__t.html#bb67841d88cfe9fd79f9b965dd72b28e">00076</a>     <span class="keywordtype">char</span> *<a class="code" href="struct__auth__serv__t.html#bb67841d88cfe9fd79f9b965dd72b28e">last_ip</a>;      
<a name="l00077"></a><a class="code" href="struct__auth__serv__t.html#7e294f129187f1449244d266028c68e5">00077</a>     <span class="keyword">struct </span><a class="code" href="struct__auth__serv__t.html">_auth_serv_t</a> *<a class="code" href="struct__auth__serv__t.html#7e294f129187f1449244d266028c68e5">next</a>;
<a name="l00078"></a>00078 } <a class="code" href="struct__auth__serv__t.html">t_auth_serv</a>;
<a name="l00079"></a>00079 
<a name="l00083"></a>00083 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__firewall__rule__t.html">_firewall_rule_t</a> {
<a name="l00084"></a>00084     <span class="keywordtype">int</span> <a class="code" href="struct__firewall__rule__t.html#4319185967c4252ced90b2d440034b47">block_allow</a>;            
<a name="l00085"></a><a class="code" href="struct__firewall__rule__t.html#de917f67daf277f81767a9ca7cb6ac1e">00085</a>     <span class="keywordtype">char</span> *<a class="code" href="struct__firewall__rule__t.html#de917f67daf277f81767a9ca7cb6ac1e">protocol</a>;             
<a name="l00086"></a><a class="code" href="struct__firewall__rule__t.html#172be165ac52a92dfe57e0911678698d">00086</a>     <span class="keywordtype">char</span> *<a class="code" href="struct__firewall__rule__t.html#172be165ac52a92dfe57e0911678698d">port</a>;                 
<a name="l00087"></a><a class="code" href="struct__firewall__rule__t.html#71fecaae85673b8c3d00a7c14f528f73">00087</a>     <span class="keywordtype">char</span> *<a class="code" href="struct__firewall__rule__t.html#71fecaae85673b8c3d00a7c14f528f73">mask</a>;                 
<a name="l00088"></a><a class="code" href="struct__firewall__rule__t.html#46cf31ace7a4781cd8f67fbf3c8f75de">00088</a>     <span class="keyword">struct </span><a class="code" href="struct__firewall__rule__t.html">_firewall_rule_t</a> *<a class="code" href="struct__firewall__rule__t.html#46cf31ace7a4781cd8f67fbf3c8f75de">next</a>;
<a name="l00089"></a>00089 } <a class="code" href="struct__firewall__rule__t.html">t_firewall_rule</a>;
<a name="l00090"></a>00090 
<a name="l00094"></a>00094 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__firewall__ruleset__t.html">_firewall_ruleset_t</a> {
<a name="l00095"></a><a class="code" href="struct__firewall__ruleset__t.html#01cf836d509e646ac7fee6d5ac791ead">00095</a>     <span class="keywordtype">char</span>                        *<a class="code" href="struct__firewall__ruleset__t.html#01cf836d509e646ac7fee6d5ac791ead">name</a>;
<a name="l00096"></a><a class="code" href="struct__firewall__ruleset__t.html#ee34ad9758267b6ae770681d6017a4a7">00096</a>     <a class="code" href="struct__firewall__rule__t.html">t_firewall_rule</a>             *<a class="code" href="struct__firewall__ruleset__t.html#ee34ad9758267b6ae770681d6017a4a7">rules</a>;
<a name="l00097"></a><a class="code" href="struct__firewall__ruleset__t.html#51556fca7d717b95a9b53695bfd0c07a">00097</a>     <span class="keyword">struct </span><a class="code" href="struct__firewall__ruleset__t.html">_firewall_ruleset_t</a>  *<a class="code" href="struct__firewall__ruleset__t.html#51556fca7d717b95a9b53695bfd0c07a">next</a>;
<a name="l00098"></a>00098 } <a class="code" href="struct__firewall__ruleset__t.html">t_firewall_ruleset</a>;
<a name="l00099"></a>00099 
<a name="l00103"></a>00103 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__trusted__mac__t.html">_trusted_mac_t</a> {
<a name="l00104"></a><a class="code" href="struct__trusted__mac__t.html#4e4381cfff2bbfbd9455640102b21f14">00104</a>     <span class="keywordtype">char</span>   *<a class="code" href="struct__trusted__mac__t.html#4e4381cfff2bbfbd9455640102b21f14">mac</a>;
<a name="l00105"></a><a class="code" href="struct__trusted__mac__t.html#949f4da24c7f33f4a8463dac5d9d565c">00105</a>     <span class="keyword">struct </span><a class="code" href="struct__trusted__mac__t.html">_trusted_mac_t</a> *<a class="code" href="struct__trusted__mac__t.html#949f4da24c7f33f4a8463dac5d9d565c">next</a>;
<a name="l00106"></a>00106 } <a class="code" href="struct__trusted__mac__t.html">t_trusted_mac</a>;
<a name="l00107"></a>00107 
<a name="l00111"></a>00111 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00112"></a>00112     <span class="keywordtype">char</span> configfile[255];       
<a name="l00113"></a><a class="code" href="structs__config.html#2d5969c6676bbefa37c435bfe018a15d">00113</a>     <span class="keywordtype">char</span> *wdctl_sock;           
<a name="l00114"></a><a class="code" href="structs__config.html#132360d3c982b91fe0cdff6622eee1f1">00114</a>     <span class="keywordtype">char</span> *internal_sock;                
<a name="l00115"></a>00115     <span class="keywordtype">int</span> daemon;                 
<a name="l00116"></a>00116     <span class="keywordtype">int</span> debuglevel;             
<a name="l00117"></a><a class="code" href="structs__config.html#ff90f0dcf55e28b34b056bb8a86f5b62">00117</a>     <span class="keywordtype">char</span> *external_interface;   
<a name="l00119"></a><a class="code" href="structs__config.html#69743b1cf3e7e8d6ed2069e67f76a9a8">00119</a>     <span class="keywordtype">char</span> *gw_id;                
<a name="l00121"></a><a class="code" href="structs__config.html#d618811ef3a6a0e3b373d972c6cf2e8c">00121</a>     <span class="keywordtype">char</span> *gw_interface;         
<a name="l00122"></a><a class="code" href="structs__config.html#a9067918ad171a070ccd631887fe2da0">00122</a>     <span class="keywordtype">char</span> *gw_address;           
<a name="l00124"></a>00124     <span class="keywordtype">int</span> gw_port;                
<a name="l00126"></a><a class="code" href="structs__config.html#860efab2a31502f548fc188ba2243f4e">00126</a>     <a class="code" href="struct__auth__serv__t.html">t_auth_serv</a> *auth_servers;  
<a name="l00127"></a><a class="code" href="structs__config.html#2ed9a59507be060fe0e1deae7fcc077b">00127</a>     <span class="keywordtype">char</span> *httpdname;            
<a name="l00129"></a>00129     <span class="keywordtype">int</span> httpdmaxconn;           
<a name="l00131"></a>00131     <span class="keywordtype">int</span> clienttimeout;          
<a name="l00133"></a>00133     <span class="keywordtype">int</span> checkinterval;          
<a name="l00135"></a>00135     <span class="keywordtype">int</span> log_syslog;             
<a name="l00136"></a>00136     <span class="keywordtype">int</span> syslog_facility;        
<a name="l00138"></a><a class="code" href="structs__config.html#93ffa58b6d61d2a8eb6dd31dc4346fd4">00138</a>     <a class="code" href="struct__firewall__ruleset__t.html">t_firewall_ruleset</a>  *rulesets;      
<a name="l00139"></a><a class="code" href="structs__config.html#205a18044b75a27d255ca3fdf30c0d64">00139</a>     <a class="code" href="struct__trusted__mac__t.html">t_trusted_mac</a> *trustedmaclist; 
<a name="l00140"></a>00140 } <a class="code" href="structs__config.html">s_config</a>;
<a name="l00141"></a>00141 
<a name="l00143"></a>00143 <a class="code" href="structs__config.html">s_config</a> *config_get_config(<span class="keywordtype">void</span>);
<a name="l00144"></a>00144 
<a name="l00146"></a>00146 <span class="keywordtype">void</span> config_init(<span class="keywordtype">void</span>);
<a name="l00147"></a>00147 
<a name="l00149"></a>00149 <span class="keywordtype">void</span> config_init_override(<span class="keywordtype">void</span>);
<a name="l00150"></a>00150 
<a name="l00152"></a>00152 <span class="keywordtype">void</span> config_read(<span class="keywordtype">char</span> *filename);
<a name="l00153"></a>00153 
<a name="l00155"></a>00155 <span class="keywordtype">void</span> config_validate(<span class="keywordtype">void</span>);
<a name="l00156"></a>00156 
<a name="l00158"></a>00158 <a class="code" href="struct__auth__serv__t.html">t_auth_serv</a> *get_auth_server(<span class="keywordtype">void</span>);
<a name="l00159"></a>00159 
<a name="l00161"></a>00161 <span class="keywordtype">void</span> mark_auth_server_bad(<a class="code" href="struct__auth__serv__t.html">t_auth_serv</a> *);
<a name="l00162"></a>00162 
<a name="l00164"></a>00164 <a class="code" href="struct__firewall__rule__t.html">t_firewall_rule</a> *get_ruleset(<span class="keywordtype">char</span> *);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="keyword">static</span> <span class="keywordtype">void</span> config_notnull(<span class="keywordtype">void</span> *parm, <span class="keywordtype">char</span> *parmname);
<a name="l00167"></a>00167 <span class="keyword">static</span> <span class="keywordtype">int</span> parse_boolean_value(<span class="keywordtype">char</span> *);
<a name="l00168"></a>00168 <span class="keyword">static</span> <span class="keywordtype">void</span> parse_auth_server(FILE *, <span class="keywordtype">char</span> *, <span class="keywordtype">int</span> *);
<a name="l00169"></a>00169 <span class="keyword">static</span> <span class="keywordtype">int</span> _parse_firewall_rule(<span class="keywordtype">char</span> *ruleset, <span class="keywordtype">char</span> *leftover);
<a name="l00170"></a>00170 <span class="keyword">static</span> <span class="keywordtype">void</span> parse_firewall_ruleset(<span class="keywordtype">char</span> *, FILE *, <span class="keywordtype">char</span> *, <span class="keywordtype">int</span> *);
<a name="l00171"></a>00171 <span class="keywordtype">void</span> parse_trusted_mac_list(<span class="keywordtype">char</span> *);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="preprocessor">#define LOCK_CONFIG() do { \</span>
<a name="l00174"></a>00174 <span class="preprocessor">        debug(LOG_DEBUG, "Locking config"); \</span>
<a name="l00175"></a>00175 <span class="preprocessor">        pthread_mutex_lock(&amp;config_mutex); \</span>
<a name="l00176"></a>00176 <span class="preprocessor">        debug(LOG_DEBUG, "Config locked"); \</span>
<a name="l00177"></a>00177 <span class="preprocessor">} while (0)</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span>
<a name="l00179"></a>00179 <span class="preprocessor">#define UNLOCK_CONFIG() do { \</span>
<a name="l00180"></a>00180 <span class="preprocessor">        debug(LOG_DEBUG, "Unlocking config"); \</span>
<a name="l00181"></a>00181 <span class="preprocessor">        pthread_mutex_unlock(&amp;config_mutex); \</span>
<a name="l00182"></a>00182 <span class="preprocessor">        debug(LOG_DEBUG, "Config unlocked"); \</span>
<a name="l00183"></a>00183 <span class="preprocessor">} while (0)</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>
<a name="l00185"></a>00185 <span class="preprocessor">#endif </span><span class="comment">/* _CONFIG_H_ */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Jun 24 00:29:52 2007 for WifiDog by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
